<!--編輯模式-->
<!DOCTYPE html>
<html lang="zh-Hant"> <!--中文-->
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>設定提醒</title>

    <style>

        /* 基本樣式 */
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }

        /* 容器樣式 */
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* 標題樣式 */
        h1 {
            text-align: center;
            color: #333;
        }

        /* 表單項目樣式 */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            margin-bottom: 5px;
            display: block;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
        }

        /* 按鈕樣式 */
        .save-button,
        .test-button {
            width: 100%;
            padding: 10px;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            text-align: center;
            font-size: 16px;
        }

        .save-button {
            background-color: #007bff;
        }

        .test-button {
            margin-top: 10px;
            background-color: #28a745;
        }

        /* RWD 設計 */
        @media (max-width: 600px) {
            .form-group {
                margin-bottom: 10px;
            }
        }
        /* Switch Button 樣式 */
        .switch {
            position: absolute;
            top: 50%;
            right: 60px;
            transform: translateY(-50%);
            width: 40px;
            height: 20px;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #007bff;
        }

        input:checked + .slider:before {
            transform: translateX(20px);
        }

        /* Flexbox 設定，使文字與 Switch Button 同行排列 */
.flex-row {
    display: flex;
    justify-content:space-between; /* 文字與按鈕兩側排列 */
    align-items: center; /* 垂直置中 */
    margin-bottom: 10px;
}

/* 樣式調整確保所有項目對齊 */
label {
    font-size: 16px; /* 根據需求調整字體大小 */
    color: #333;
}

.switch {
    display: inline-block;
    width: 40px;
    height: 20px;
    position: relative;
    top: 10px;
    right: 500px;
}

/* 為重複選單設置與其他選單相同的寬度和樣式 */
#repeat {
    width: 100%; /* 與其他輸入框一致的寬度 */
    padding: 8px; /* 與其他輸入框一致的內間距 */
    box-sizing: border-box; /* 讓寬度包含內邊距與邊框 */
    margin-top: 10px; /* 與其他表單項目一致的間距 */
    border-radius: 5px; /* 圓角效果 */
    border: 1px solid #ccc; /* 加上邊框，與其他下拉選單一致 */
    background-color: white; /* 背景色 */
}

    </style>

</head>


<body>

    <div class="container">
        
        <h1>設定提醒</h1>

        <!-- 標題輸入框 -->
        <div class="form-group">
            <label for="title">標題</label>
            <input type="text" id="title" placeholder="輸入提醒標題">
        </div>

        <!-- 時間選擇 -->
        <div class="form-group">
            <label for="time">時間</label>
            <input type="time" id="time" value="${new Date().toTimeString().substr(0, 5)}">
        </div>

        <!-- 重複選單 -->
        <div class="form-group flex-row">
            <label for="repeatSwitch">重複</label>
            <label class="switch">
                <input type="checkbox" id="repeatSwitch">
                <span class="slider round"></span>
            </label>
        </div>

        <!-- 複選下拉選單（預設隱藏） -->
        <div id="repeatContainer" style="display: none;">
            <select id="repeat" multiple>
                <option value="每天">每天</option>
                <option value="週一">週一</option>
                <option value="週二">週二</option>
                <option value="週三">週三</option>
                <option value="週四">週四</option>
                <option value="週五">週五</option>
                <option value="週六">週六</option>                    
                <option value="週日">週日</option>
            </select>
        </div>

        <!-- 主類別選單 -->
        <div class="form-group">
            <label for="mainCategory">主類別</label>
            <select id="mainCategory">
                <option></option>
                <option value="工作">工作</option>
                <option value="個人">個人</option>
                <option value="其他">其他</option>
            </select>
        </div>

        <!-- 子類別選單 -->
        <div class="form-group">
            <label for="subCategory">子類別</label>
            <select id="subCategory">
                <option></option>
                <option value="會議">會議</option>
                <option value="截止日期">截止日期</option>
                <option value="約會">約會</option>
                <option value="其他">其他</option>
            </select>
        </div>

        <!-- 通知方式選單 -->
        <div class="form-group">
            <label for="notificationMethod">通知方式</label>
            <select id="notificationMethod">
                <option></option>
                <option value="Line">Line</option>
                <option value="Email">Email</option>
                <option value="WhatsApp">WhatsApp</option>
                <option value="簡訊" disabled>簡訊(已停用)</option>
            </select>
            <button class="test-button" id="testNotification">測試</button>
        </div>

        <!-- 保存按鈕 -->
        <button class="save-button" id="saveReminder">保存</button>
    </div>
</body>
</html>


    <script>
        // 从 URL 中获取 id 参数
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        // 顯示或隱藏複選下拉選單
        document.getElementById('repeatSwitch').addEventListener('change', function() {
            const repeatContainer = document.getElementById('repeatContainer');
            repeatContainer.style.display = this.checked ? 'block' : 'none';
        });

        // 當選取 "每天" 時，自動選取所有選項
        document.getElementById('repeat').addEventListener('change', function() {
            const selectedOptions = Array.from(this.selectedOptions).map(option => option.value);
            if (selectedOptions.includes('每天')) {
                Array.from(this.options).forEach(option => option.selected = true);
            }
        });

        // 測試通知功能
        document.getElementById('testNotification').addEventListener('click', function() {
            const method = document.getElementById('notificationMethod').value;
            if (method === '') {
                alert('請選擇通知方式後再進行測試。');
            } else {
                alert('測試通知已發送到 ' + method);
            }
        });

        // 當用戶點擊保存按鈕時
        document.getElementById('saveReminder').addEventListener('click', function() {
        const title = document.getElementById('title').value.trim();
        const time = document.getElementById('time').value;
        const repeat = Array.from(document.getElementById('repeat').selectedOptions).map(opt => opt.value).join(', ');
        const mainCategory = document.getElementById('mainCategory').value;
        const subCategory = document.getElementById('subCategory').value;
        const notificationMethod = document.getElementById('notificationMethod').value;

        // 確保所有欄位都有填寫
        if (!title || !time || !mainCategory || !subCategory || !notificationMethod) {
            alert('請填寫所有欄位。');
            return;
        }

        // 從本地存儲中讀取提醒列表
        let reminders = JSON.parse(localStorage.getItem('reminders')) || [];
        const originalReminderTitle = localStorage.getItem('editingReminderTitle');

        // 確認提醒是否已存在
        const existingReminderIndex = reminders.findIndex(r => r.title === originalReminderTitle);

        // 確保所有欄位都有值，如果某個欄位無更動則使用原值
        const updatedReminder = {
            title: title || reminders[existingReminderIndex].title,
            time: time || reminders[existingReminderIndex].time,
            repeat: repeat || reminders[existingReminderIndex].repeat,
            mainCategory: mainCategory || reminders[existingReminderIndex].mainCategory,
            subCategory: subCategory || reminders[existingReminderIndex].subCategory,
            notificationMethod: notificationMethod || reminders[existingReminderIndex].notificationMethod
        };

        // 更新原有提醒
        reminders[existingReminderIndex] = updatedReminder;

        // 更新本地存儲中的提醒列表
        localStorage.setItem('reminders', JSON.stringify(reminders));

        alert('提醒已更新！');
        window.location.href = 'index.html';  // 返回主頁
    });

    // 加載正在編輯的提醒
    document.addEventListener('DOMContentLoaded', function() {
        const notificationId = getQueryParam('id');
        if (notificationId) {
        // 从后端获取提醒数据
        axios.get(`/api/notifications/${notificationId}`)
        .then(response => {
        let notification = response.data; // 從後端取得的提醒資料

        // 更新页面上的提醒详情
        console.log(notification.subject);
        // 將資料填充到輸入框中
        document.getElementById('title').value = notification.subjectName || '';
        })
        .catch(error => {
            console.error('Error fetching notification:', error);
        });

        // const editingReminder = JSON.parse(localStorage.getItem('editingReminder'));
        // if (editingReminder) {
        //     document.getElementById('title').value = editingReminder.title;
        //     document.getElementById('time').value = editingReminder.time;
        //     // 設置重複模式和其他資料
        //     document.getElementById('mainCategory').value = editingReminder.mainCategory;
        //     document.getElementById('subCategory').value = editingReminder.subCategory;
        //     document.getElementById('notificationMethod').value = editingReminder.notificationMethod;
        //     localStorage.setItem('editingReminderTitle', editingReminder.title);  // 儲存編輯提醒的標題
        // }
        
    }

    // var select = document.getElementById("簡訊");
    //     var optionToDisable = select.option[4];
    //     optionToDisable.disabled=true;
});


</script>

