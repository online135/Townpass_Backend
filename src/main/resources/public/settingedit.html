<!--編輯模式-->
<!DOCTYPE html>
<html lang="zh-Hant"> <!--中文-->
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- 引用外部 CSS 檔案 -->
    <link rel="stylesheet" href="style.css">

    <title>設定提醒</title>

    <style>
        /* 容器樣式 */
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* RWD 設計 */
        @media (max-width: 600px) {
            .form-group {
                margin-bottom: 10px;
            }
        }

        /* 樣式調整確保所有項目對齊 */
        label {
            font-size: 16px; /* 根據需求調整字體大小 */
            color: #333;
        }

        .switch {
            display: inline-block;
            width: 40px;
            height: 20px;
            position: relative;
            top: 10px;
            right: 500px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>設定提醒</h1>

        <!-- 標題輸入框 -->
        <div class="form-group">
            <label for="title">標題</label>
            <input type="text" id="title" placeholder="輸入提醒標題">
        </div>

        <!-- 時間選擇 -->
        <div class="form-group">
            <label for="time">時間</label>
            <input type="time" id="time" value="${new Date().toTimeString().substr(0, 5)}">
        </div>

        <!-- 重複選單 -->
        <div class="form-group flex-row">
            <label for="repeatSwitch">重複</label>
            <label class="switch">
                <input type="checkbox" id="repeatSwitch">
                <span class="slider round"></span>
            </label>
        </div>

        <!-- 複選下拉選單（預設隱藏） -->
        <div id="repeatContainer" style="display: none;">
            <select id="repeat" multiple>
                <option value="每天">每天</option>
                <option value="週一">週一</option>
                <option value="週二">週二</option>
                <option value="週三">週三</option>
                <option value="週四">週四</option>
                <option value="週五">週五</option>
                <option value="週六">週六</option>                    
                <option value="週日">週日</option>
            </select>
        </div>

        <!-- 主類別選單 -->
        <div class="form-group">
            <label for="mainCategory">主類別</label>
            <select id="mainCategory">
                <option></option>
                <option value="工作">工作</option>
                <option value="個人">個人</option>
                <option value="其他">其他</option>
            </select>
        </div>

        <!-- 子類別選單 -->
        <div class="form-group">
            <label for="subCategory">子類別</label>
            <select id="subCategory">
                <option></option>
                <option value="會議">會議</option>
                <option value="截止日期">截止日期</option>
                <option value="約會">約會</option>
                <option value="其他">其他</option>
            </select>
        </div>

        <!-- 通知方式選單 -->
        <div class="form-group">
            <label for="notificationMethod">通知方式</label>
            <select id="notificationMethod">
                <option></option>
                <option value="Line">Line</option>
                <option value="Email">Email</option>
                <option value="WhatsApp">WhatsApp</option>
                <option value="簡訊" disabled>簡訊(已停用)</option>
            </select>
            <button class="test-button" id="testNotification">測試</button>
        </div>

        <!-- 保存按鈕 -->
        <button class="save-button" id="saveReminder">保存</button>
    </div>
</body>
</html>


    <script>
        // 从 URL 中获取 id 参数
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        // 顯示或隱藏複選下拉選單
        document.getElementById('repeatSwitch').addEventListener('change', function() {
            const repeatContainer = document.getElementById('repeatContainer');
            repeatContainer.style.display = this.checked ? 'block' : 'none';
        });

        // 當選取 "每天" 時，自動選取所有選項
        document.getElementById('repeat').addEventListener('change', function() {
            const selectedOptions = Array.from(this.selectedOptions).map(option => option.value);
            if (selectedOptions.includes('每天')) {
                Array.from(this.options).forEach(option => option.selected = true);
            }
        });

        // 測試通知功能
        document.getElementById('testNotification').addEventListener('click', function() {
            const method = document.getElementById('notificationMethod').value;
            if (method === '') {
                alert('請選擇通知方式後再進行測試。');
            } else {
                alert('測試通知已發送到 ' + method);
            }
        });

        // 當用戶點擊保存按鈕時
        document.getElementById('saveReminder').addEventListener('click', function() {
        const title = document.getElementById('title').value.trim();
        const time = document.getElementById('time').value;
        const repeat = Array.from(document.getElementById('repeat').selectedOptions).map(opt => opt.value).join(', ');
        const mainCategory = document.getElementById('mainCategory').value;
        const subCategory = document.getElementById('subCategory').value;
        const notificationMethod = document.getElementById('notificationMethod').value;

        // 確保所有欄位都有填寫
        if (!title || !time || !mainCategory || !subCategory || !notificationMethod) {
            alert('請填寫所有欄位。');
            return;
        }

        // 從本地存儲中讀取提醒列表
        let reminders = JSON.parse(localStorage.getItem('reminders')) || [];
        const originalReminderTitle = localStorage.getItem('editingReminderTitle');

        // 確認提醒是否已存在
        const existingReminderIndex = reminders.findIndex(r => r.title === originalReminderTitle);

        // 確保所有欄位都有值，如果某個欄位無更動則使用原值
        const updatedReminder = {
            title: title || reminders[existingReminderIndex].title,
            time: time || reminders[existingReminderIndex].time,
            repeat: repeat || reminders[existingReminderIndex].repeat,
            mainCategory: mainCategory || reminders[existingReminderIndex].mainCategory,
            subCategory: subCategory || reminders[existingReminderIndex].subCategory,
            notificationMethod: notificationMethod || reminders[existingReminderIndex].notificationMethod
        };

        // 更新原有提醒
        reminders[existingReminderIndex] = updatedReminder;

        // 更新本地存儲中的提醒列表
        localStorage.setItem('reminders', JSON.stringify(reminders));

        alert('提醒已更新！');
        window.location.href = 'index.html';  // 返回主頁
    });

    // 加載正在編輯的提醒
    document.addEventListener('DOMContentLoaded', function() {
        const notificationId = getQueryParam('id');
        if (notificationId) {
        // 从后端获取提醒数据
        axios.get(`/api/notifications/${notificationId}`)
        .then(response => {
        let notification = response.data; // 從後端取得的提醒資料

        // 更新页面上的提醒详情
        console.log(notification.subject);
        // 將資料填充到輸入框中
        document.getElementById('title').value = notification.subjectName || '';
        })
        .catch(error => {
            console.error('Error fetching notification:', error);
        });

        // const editingReminder = JSON.parse(localStorage.getItem('editingReminder'));
        // if (editingReminder) {
        //     document.getElementById('title').value = editingReminder.title;
        //     document.getElementById('time').value = editingReminder.time;
        //     // 設置重複模式和其他資料
        //     document.getElementById('mainCategory').value = editingReminder.mainCategory;
        //     document.getElementById('subCategory').value = editingReminder.subCategory;
        //     document.getElementById('notificationMethod').value = editingReminder.notificationMethod;
        //     localStorage.setItem('editingReminderTitle', editingReminder.title);  // 儲存編輯提醒的標題
        // }
        
    }

    // var select = document.getElementById("簡訊");
    //     var optionToDisable = select.option[4];
    //     optionToDisable.disabled=true;
});


</script>

