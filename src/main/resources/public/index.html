<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>提醒列表</title>

    <!-- 引用外部 CSS 檔案 -->
    <link rel="stylesheet" href="style.css">

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>

    <style>
        /* 設定容器樣式，讓內容居中顯示 */
        .container {
            width: 100%; /* 設定寬度為100% */
            max-width: 600px; /* 設定最大寬度為600px */
            margin: 0 auto; /* 讓容器自動居中 */
            padding: 20px;
            position: relative; /* 方便定位其他元素 */
        }
    </style>
</head>

<body>
    <!-- 提醒列表主容器 -->
    <div class="container">
        <!-- 編輯模式按鈕 -->
        <button class="edit-button" onclick="toggleEditMode()">編輯</button>

        <h1>提醒列表</h1>

        <!-- 提醒卡片顯示區域 -->
        <div id="reminderList"></div>

        <!-- 新增提醒按鈕，導向設定頁面 -->
        <button class="add-button" onclick="window.location.href='settingnew.html'">+</button>
    </div>

    <script>
        // 全局變數，用來追蹤是否處於編輯模式
        let isEditMode = false;

    // 發送 GET 請求到後端，取得提醒列表
    axios.get('/api/notifications')
        .then(response => {
            const reminders = response.data; // 從後端取得的提醒列表資料

            // 迭代每一個提醒項目，生成對應的 HTML 元素
            reminders.forEach((reminder, index) => {
                const reminderCard = document.createElement('div'); // 建立提醒卡片元素
                reminderCard.className = 'reminder-card'; // 設定卡片的樣式類別
                reminderCard.innerHTML = `
                    <div class="reminder-text">
                        <strong>${reminder.subjectName}</strong><br>
                        ${reminder.time} - ${reminder.repeat}<br>
                        通知方式2: ${reminder.notificationMethod}
                    </div>
                    <button class="delete-button" onclick="deleteReminder(${index})">×</button>

                    <label class="switch">
                        <input type="checkbox" ${reminder.isActive ? 'checked' : ''}>
                        <span class="slider round"></span>
                    </label>
                `;

                // 只將點擊事件添加到文字區域，而非整個卡片
                const reminderText = reminderCard.querySelector('.reminder-text');
                reminderText.onclick = function() {
                    if (isEditMode) {
                        localStorage.setItem('editingReminder', JSON.stringify(reminder)); // 保存要編輯的提醒內容
                        localStorage.setItem('editingReminderIndex', index); // 保存提醒的索引
                        const reminderId = reminder.id; // 获取提醒的 ID

                        // 调试输出 ID 和 URL
                        console.log('Reminder ID:', reminderId);
                        const url = `http://localhost:8080/settingedit.html?id=${reminderId}`;
                        console.log('Redirect URL:', url);

                        // 确保 URL 正确设置并重定向
                        window.location.href = url;
                    }
                };

                // 將提醒卡片添加到提醒列表容器中
                reminderList.appendChild(reminderCard);
            });
        })
        .catch(error => {
            console.error('無法取得提醒資料:', error); // 處理錯誤情況
        });

        // 切換編輯模式，顯示或隱藏刪除按鈕
        function toggleEditMode() {
            isEditMode = !isEditMode; // 切換編輯模式狀態
            document.querySelectorAll('.reminder-card').forEach(card => {
                card.classList.toggle('editing', isEditMode); // 切換每張卡片的樣式
            });
        }

        // 刪除提醒功能
        function deleteReminder(index) {
            let reminders = JSON.parse(localStorage.getItem('reminders')) || []; // 從 localStorage 取得提醒列表
            reminders.splice(index, 1); // 刪除指定索引的提醒
            localStorage.setItem('reminders', JSON.stringify(reminders)); // 更新提醒列表
            window.location.reload(); // 重新加載頁面以刷新顯示
        }
    </script>
</body>
</html>
